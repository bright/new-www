{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/write-native-in-react-native","result":{"data":{"markdownRemark":{"html":"<p>Using custom native components in React Native is a common thing, so sooner or later you may have to write some functionality in a native language and use it in your application. Let me show you a simple example how to do that.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/26fa3c42adcdb65855ddf137fc652154/b28e6/toymodel.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.97297297297297%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUBAwT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB2KGklXgM/wD/xAAaEAEBAAIDAAAAAAAAAAAAAAABAgADEiEi/9oACAEBAAEFAt9cmy1023HrFbZ6P//EABYRAQEBAAAAAAAAAAAAAAAAABEBEP/aAAgBAwEBPwFLn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABsQAAMBAAMBAAAAAAAAAAAAAAABEQISITGx/9oACAEBAAY/AuKVfwrzou1GPWmSdHtP/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARYSExQXH/2gAIAQEAAT8hAa92scizBgVPzgG8y4ddi+5G1q0z/9oADAMBAAIAAwAAABDnD//EABcRAQEBAQAAAAAAAAAAAAAAAAEhABH/2gAIAQMBAT8QIm5r3f/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQABBQEBAAAAAAAAAAAAAAERACExQWFR8P/aAAgBAQABPxAsiFAxAzq9zlFMBuAx361SlRCSJ7SrR1UsGZi0GipASCogfAa1WfdUC4eV/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"toy model\"\n        title=\"toy model\"\n        src=\"/static/26fa3c42adcdb65855ddf137fc652154/1c72d/toymodel.jpg\"\n        srcset=\"/static/26fa3c42adcdb65855ddf137fc652154/a80bd/toymodel.jpg 148w,\n/static/26fa3c42adcdb65855ddf137fc652154/1c91a/toymodel.jpg 295w,\n/static/26fa3c42adcdb65855ddf137fc652154/1c72d/toymodel.jpg 590w,\n/static/26fa3c42adcdb65855ddf137fc652154/b28e6/toymodel.jpg 626w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>First prepare code in a separate application</h3>\n<p>We start with creating a simple native application. In this example, our app will show the user information when the headset is plugged in or out. It involves several native interactions:</p>\n<ul>\n<li>app lifecycle interaction while registering or unregistering listeners</li>\n<li>sending and receiving data via intents</li>\n<li>showing information by toasts</li>\n<li>using application context</li>\n</ul>\n<p>Assuming you are familiar with creating native Android applications, the example below will be very easy. Our app uses one activity with a simple layout, that later is going to be irrelevant. Start with the private fields that will be used with our activity:</p>\n<pre><code class=\"language-java\">private Context mContext;\n\nprivate final BroadcastReceiver mHeadsetPlugReceiver = new BroadcastReceiver() {\n    @Override\n    public void onReceive(Context context, Intent intent) {\n        if (intent.getAction().equals(Intent.ACTION_HEADSET_PLUG)) {\n            boolean plugged = (intent.getIntExtra(\"state\", 0) == 1);\n            String message = plugged ? \"Headset plugged in\" : \"Headset plugged out\";\n            Toast.makeText(mContext, message, Toast.LENGTH_SHORT).show();\n        }\n    }\n};\n</code></pre>\n<p>Remembering a reference to your application context is not always necessary, as long as we can call <code>getApplicationContext</code> method within our Activity. Let's keep it now because we will modify it later.<br>\n<code>BroadcastReceiver</code> is an abstract class and describes behavior on receiving information via Intent.</p>\n<p>Registering listener looks like this:</p>\n<pre><code class=\"language-java\">private void registerBroadcastReceiver() {\n    IntentFilter filter = new IntentFilter();\n    filter.addAction(Intent.ACTION_HEADSET_PLUG);\n    registerReceiver(mHeadsetPlugReceiver, filter);\n}\n</code></pre>\n<p><code>registerReceiver</code> method is an Activity's method and may be invoked on Context class object.</p>\n<p>In <code>onCreate</code> method save the reference to the application context and register broadcast receiver:</p>\n<pre><code class=\"language-java\">mContext = this;\nregisterBroadcastReceiver();\n</code></pre>\n<p>In the end, following clean coding principles, unregister receiver when closing your application using Activity's <code>unregisterReceiver</code> method:</p>\n<pre><code class=\"language-java\">@Override\nprotected void onDestroy() {\n    unregisterReceiver(mHeadsetPlugReceiver);\n    super.onDestroy();\n}\n</code></pre>\n<p>That's it, that is what we're going to work on. The app shows a simple message while plugging the headset in:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/af7633c9e2102e54169e39ad3a0b93ce/07484/screenshot1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQY021QSwqFMAz0jNJLuHPhokgRqoj1BsW19EyCx/CDX0YSeFJ9BoaE6UyaJNi2DT+s64p930Hh81+gIC15fD7wm1Ge5xlt26IsSxhjHqiqCnVd85tzjrW+99FwWRb+tes6hGGIOI4hpUSSJHedpinnKIoghEDf9+wh7+eEtMIwDLDWIssyFEUBrTXyPOepaELilFJomgbjOP6tHbxveBwHzvPkdd6YpumuSUPa9w0vSSBcu+dteqkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"native app\"\n        title=\"native app\"\n        src=\"/static/af7633c9e2102e54169e39ad3a0b93ce/07484/screenshot1.png\"\n        srcset=\"/static/af7633c9e2102e54169e39ad3a0b93ce/12f09/screenshot1.png 148w,\n/static/af7633c9e2102e54169e39ad3a0b93ce/e4a3f/screenshot1.png 295w,\n/static/af7633c9e2102e54169e39ad3a0b93ce/07484/screenshot1.png 540w\"\n        sizes=\"(max-width: 540px) 100vw, 540px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Let's use it in our RN project!</p>\n<h3>/react-project/android</h3>\n<p>In your React project directory, there is an <code>android</code> folder. Its structure looks like every Android project and you may open it with Android Studio for convenient navigation. Source files are under <code>/app/src/main/java/{some}/{packages}/</code> and here we will add our code. We will have to pack our functionality in a specific way. Check <code>MainApplication.java</code> file first. It's extending <code>Application</code> class and implements <code>ReactApplication</code> interface. Take a look at <code>getPackages</code> method:</p>\n<pre><code class=\"language-java\">@Override\nprotected List&#x3C;ReactPackage> getPackages() {\n  return Arrays.&#x3C;ReactPackage>asList(\n      new MainReactPackage()\n  );\n}\n</code></pre>\n<p>An application written in React Native is built like any other Android application, but React Native packages are added at runtime and it is specified here. You may write any native code and link it here, but you have to add it as <code>ReactPackage</code> and initialize it in <code>getPackages</code> method. Will need two files: <em>package</em> and <em>module</em>.</p>\n<p>First create a package file that implements <code>com.facebook.react.ReactPackage</code> interface. It's got two methods and its basic implementation looks like this:</p>\n<pre><code class=\"language-java\">public class MyHeadsetLibPackager implements ReactPackage {\n\n    @Override\n    public List&#x3C;NativeModule> createNativeModules(ReactApplicationContext reactContext) {\n        List&#x3C;NativeModule> modules = new ArrayList&#x3C;>();\n\n        modules.add(new MyHeadsetLibModule(reactContext));\n\n        return modules;\n    }\n\n    @Override\n    public List&#x3C;ViewManager> createViewManagers(ReactApplicationContext reactContext) {\n        return Collections.emptyList();\n    }\n}\n</code></pre>\n<p>The most important part is to initialize module in <code>createNativeModules</code> method:</p>\n<pre><code class=\"language-java\">modules.add(new MyHeadsetLibModule(reactContext));\n</code></pre>\n<p><code>MyHeadsetLibModule</code> is how we name our second class. It will contain all functionalities of our library. It is necessary to extend <code>com.facebook.react.bridge.ReactContextBaseJavaModule</code> class for that.</p>\n<pre><code class=\"language-java\">import com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.bridge.ReactContextBaseJavaModule;\n\npublic class MyHeadsetLibModule extends ReactContextBaseJavaModule {\n\n    public MyHeadsetLibModule(ReactApplicationContext reactContext) {\n\n        super(reactContext);\n\n        /*\n            Our starting point.\n        */\n\n    }\n}\n</code></pre>\n<p>Last thing necessary to compile a project is to add dependency to <code>/app/build.gradle</code></p>\n<pre><code>dependencies {\n    ...\n    compile \"com.facebook.react:react-native:+\"\n    ...\n}\n</code></pre>\n<h3>Moving from activity</h3>\n<p>Now we can implement everything as we did in our activity. Just mind two consequences of moving from <code>Activity</code> to <code>ReactContextBaseJavaModule</code>.</p>\n<p>First:<br>\n<strong>Who's got the context?</strong><br>\nFrom now we cannot call activity's methods like <code>registerReceiver</code> just like that. We also cannot access the application's context by calling <code>getApplicationContext</code>. That's why, in the module's constructor we get <code>ReactContext</code> instance. All activity's methods will be called from it.</p>\n<p>Second:<br>\n<strong>Where are the lifecycle methods?</strong><br>\nRight now nowhere. But just implement <code>LifecycleEventListener</code> in your module class. It's an interface that provides three basic lifecycle methods:</p>\n<ul>\n<li><code>void onHostResume()</code>   </li>\n<li><code>void onHostPause()</code>   </li>\n<li><code>void onHostDestroy()</code>   </li>\n</ul>\n<p>All lifecycle functionalities implement here. Then in the constructor register listener with <code>reactContext.addLifecycleEventListener(this)</code> and... done. Our module behaves like activity now.</p>\n<p>The last thing to make our module visible is to override <code>getName</code> method. It should be returning the name of our module, like that:</p>\n<pre><code class=\"language-java\">@Override\npublic String getName() {\n    return \"MyHeadsetLibModule\";\n}\n</code></pre>\n<p>Following all these guidelines a final form of our module rewritten from activity looks like this:</p>\n<pre><code class=\"language-java\">import android.content.BroadcastReceiver;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.IntentFilter;\nimport android.widget.Toast;\n\nimport com.facebook.react.bridge.LifecycleEventListener;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.bridge.ReactContextBaseJavaModule;\n\npublic class MyHeadsetLibModule extends ReactContextBaseJavaModule implements LifecycleEventListener {\n\n    private ReactApplicationContext mContext;\n\n    private final BroadcastReceiver mHeadsetPlugReceiver = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            if (intent.getAction().equals(Intent.ACTION_HEADSET_PLUG)) {\n                boolean plugged = (intent.getIntExtra(\"state\", 0) == 1);\n                String message = plugged ? \"Headset plugged in\" : \"Headset plugged out\";\n                Toast.makeText(mContext, message, Toast.LENGTH_SHORT).show();\n            }\n        }\n    };\n\n    public MyHeadsetLibModule(ReactApplicationContext reactContext) {\n        super(reactContext);\n        mContext = reactContext;\n        registerBroadcastReceiver();\n    }\n\n    private void registerBroadcastReceiver() {\n        IntentFilter filter = new IntentFilter();\n        filter.addAction(Intent.ACTION_HEADSET_PLUG);\n        mContext.registerReceiver(mHeadsetPlugReceiver, filter);\n    }\n\n    @Override\n    public String getName() {\n        return \"MyHeadsetLibModule\";\n    }\n\n    @Override\n    public void onHostResume() {\n\n    }\n\n    @Override\n    public void onHostPause() {\n\n    }\n\n    @Override\n    public void onHostDestroy() {\n        mContext.unregisterReceiver(mHeadsetPlugReceiver);\n    }    \n}\n</code></pre>\n<h3>Exposing methods to JS</h3>\n<p>What if we would like to register <code>BroadcastReceiver</code> not on the application start, but later, and invoke it from React Native module in TypeScript? Here comes <code>@ReactMehod</code> annotation. Just add a method with it to your module class:</p>\n<pre><code class=\"language-java\">@ReactMethod\npublic void startTrackingAudioJackPlug() {\n    registerBroadcastReceiver();\n}\n</code></pre>\n<p>Now in any TypeScript file, we can import it from <code>react-native</code>:</p>\n<pre><code class=\"language-js\">import { NativeModules } from 'react-native'\n</code></pre>\n<p>and use calling it directly from NativeModules object:</p>\n<pre><code class=\"language-js\">NativeModules.MyHeadsetLibModule.startTrackingAudioJackPlug()\n</code></pre>\n<h3>Getting callback from native module</h3>\n<p>Last modification - let the message about plugging headset will be displayed not by native toast, but some React Native alert. To do so we have to emit information about plugging headset from native module to JS module. In native code add this:</p>\n<pre><code class=\"language-java\">reactContext\n    .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)\n    .emit(eventName, params);\n</code></pre>\n<ol>\n<li><code>eventName</code> is <code>String</code> object and identifies emitted message   </li>\n<li><code>params</code> is <code>WritableMap</code> object and contains parameters in simple key-value collection</li>\n</ol>\n<p>Now just register listener in JS module to receive the emitted message. Import <code>DeviceEventEmitter</code> from <code>'react-native'</code> and add this code in <code>componentDidMount</code> method:</p>\n<pre><code class=\"language-js\">DeviceEventEmitter.addListener('CustomNameOfTheEvent', function(e: Event) {\n\n    /*\n        Here you can display an alert.\n        Get parameters values from event like this:\n        let parameter = e[\"key\"]\n    */\n\n})\n</code></pre>\n<p>That's it. We have just implemented a native functionality with bidirectional communication.</p>","excerpt":"Using custom native components in React Native is a common thing, so sooner or later you may have to write some functionality in a nativeâ€¦","frontmatter":{"slug":null,"title":"Putting native in React Native on Android","description":null,"author":"radek","tags":["android","react native","java","platform specific"],"date":"2017-11-13T23:00:00.000Z","image":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#e8e8e8","images":{"fallback":{"src":"/static/26fa3c42adcdb65855ddf137fc652154/4b520/toymodel.jpg","srcSet":"/static/26fa3c42adcdb65855ddf137fc652154/7d131/toymodel.jpg 157w,\n/static/26fa3c42adcdb65855ddf137fc652154/f481d/toymodel.jpg 313w,\n/static/26fa3c42adcdb65855ddf137fc652154/4b520/toymodel.jpg 626w","sizes":"(min-width: 626px) 626px, 100vw"},"sources":[{"srcSet":"/static/26fa3c42adcdb65855ddf137fc652154/c7d5c/toymodel.webp 157w,\n/static/26fa3c42adcdb65855ddf137fc652154/84d1c/toymodel.webp 313w,\n/static/26fa3c42adcdb65855ddf137fc652154/3700e/toymodel.webp 626w","type":"image/webp","sizes":"(min-width: 626px) 626px, 100vw"}]},"width":626,"height":457}}}},"timeToRead":7,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2017-11-14-write-native-in-react-native.md"},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2017-11-14-write-native-in-react-native.md"}},"staticQueryHashes":["2189233960","3181594896"]}